{"ast":null,"code":"'use strict'; // Import browser version otherwise electron-renderer will end up with node\n// version and fail.\n\nconst _require = require('ipfs-core-utils/src/files/normalise-input/index.browser'),\n      normaliseInput = _require.normaliseInput;\n\nconst modeToString = require('./mode-to-string');\n/**\n * @typedef {import('ipfs-core-types/src/utils').ImportCandidateStream} ImportCandidateStream\n * @typedef {import('ipfs-core-types/src/utils').ImportCandidate} ImportCandidate\n */\n\n/**\n * @param {ImportCandidateStream|ImportCandidate} source\n * @param {AbortController} abortController\n * @param {Headers|Record<string, string>} [headers]\n */\n\n\nasync function multipartRequest(source, abortController, headers = {}) {\n  const parts = [];\n  const formData = new FormData();\n  let index = 0;\n  let total = 0; // @ts-ignore wrong input type for normaliseInput\n\n  for await (const _ref of normaliseInput(source)) {\n    const content = _ref.content;\n    const path = _ref.path;\n    const mode = _ref.mode;\n    const mtime = _ref.mtime;\n    let fileSuffix = '';\n    const type = content ? 'file' : 'dir';\n\n    if (index > 0) {\n      fileSuffix = \"-\".concat(index);\n    }\n\n    let fieldName = type + fileSuffix;\n    const qs = [];\n\n    if (mode !== null && mode !== undefined) {\n      qs.push(\"mode=\".concat(modeToString(mode)));\n    }\n\n    if (mtime != null) {\n      const secs = mtime.secs,\n            nsecs = mtime.nsecs;\n      qs.push(\"mtime=\".concat(secs));\n\n      if (nsecs != null) {\n        qs.push(\"mtime-nsecs=\".concat(nsecs));\n      }\n    }\n\n    if (qs.length) {\n      fieldName = \"\".concat(fieldName, \"?\").concat(qs.join('&'));\n    }\n\n    if (content) {\n      formData.set(fieldName, content, path != null ? encodeURIComponent(path) : undefined);\n      const end = total + content.size;\n      parts.push({\n        name: path,\n        start: total,\n        end\n      });\n      total = end;\n    } else if (path != null) {\n      formData.set(fieldName, new File([''], encodeURIComponent(path), {\n        type: 'application/x-directory'\n      }));\n    } else {\n      throw new Error('path or content or both must be set');\n    }\n\n    index++;\n  }\n\n  return {\n    total,\n    parts,\n    headers,\n    body: formData\n  };\n}\n\nmodule.exports = multipartRequest;","map":null,"metadata":{},"sourceType":"script"}