{"ast":null,"code":"import _regeneratorRuntime from\"/Users/israeladelaja/Desktop/Product DApp/client/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"/Users/israeladelaja/Desktop/Product DApp/client/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _classCallCheck from\"/Users/israeladelaja/Desktop/Product DApp/client/node_modules/@babel/runtime/helpers/esm/classCallCheck\";import _createClass from\"/Users/israeladelaja/Desktop/Product DApp/client/node_modules/@babel/runtime/helpers/esm/createClass\";import _possibleConstructorReturn from\"/Users/israeladelaja/Desktop/Product DApp/client/node_modules/@babel/runtime/helpers/esm/possibleConstructorReturn\";import _getPrototypeOf from\"/Users/israeladelaja/Desktop/Product DApp/client/node_modules/@babel/runtime/helpers/esm/getPrototypeOf\";import _inherits from\"/Users/israeladelaja/Desktop/Product DApp/client/node_modules/@babel/runtime/helpers/esm/inherits\";import React,{Component}from\"react\";import ProductBuyContract from\"./contracts/ProductBuy.json\";import TestToken from\"./contracts/TestToken.json\";import getWeb3 from\"./getWeb3\";import\"./App.css\";var Main=/*#__PURE__*/function(_Component){_inherits(Main,_Component);function Main(){var _getPrototypeOf2;var _this;_classCallCheck(this,Main);for(var _len=arguments.length,args=new Array(_len),_key=0;_key<_len;_key++){args[_key]=arguments[_key];}_this=_possibleConstructorReturn(this,(_getPrototypeOf2=_getPrototypeOf(Main)).call.apply(_getPrototypeOf2,[this].concat(args)));_this.state={products:null,web3:null,account:null,contract:null,token:null,tokenName:null,approved:false,product:null,statuses:null,decimals:null,balance:null};_this.componentDidMount=/*#__PURE__*/_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){var web3,account,networkId,deployedNetworkProduct,instance,tokenAddress,deployedNetworkToken,token,product,products,tokenName,tokenSymbol,decimals,balance,statuses;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.prev=0;_context.next=3;return getWeb3();case 3:web3=_context.sent;_context.next=6;return window.ethereum.request({method:'eth_accounts'});case 6:account=_context.sent;console.log(account[0]);// Get the contract instance.\n_context.next=10;return web3.eth.net.getId();case 10:networkId=_context.sent;deployedNetworkProduct=ProductBuyContract.networks[networkId];instance=new web3.eth.Contract(ProductBuyContract.abi,deployedNetworkProduct&&deployedNetworkProduct.address);_context.next=15;return instance.methods.token().call();case 15:tokenAddress=_context.sent;deployedNetworkToken=TestToken.networks[networkId];token=new web3.eth.Contract(TestToken.abi,deployedNetworkToken&&tokenAddress);product=deployedNetworkProduct.address;_context.next=21;return instance.methods.viewProducts().call();case 21:products=_context.sent;_context.next=24;return token.methods.name().call();case 24:tokenName=_context.sent;_context.next=27;return token.methods.symbol().call();case 27:tokenSymbol=_context.sent;_context.next=30;return token.methods.decimals().call();case 30:decimals=_context.sent;_context.next=33;return token.methods.balanceOf(account[0]).call();case 33:balance=_context.sent;_context.next=36;return instance.methods.getProductStatuses().call();case 36:statuses=_context.sent;console.log(statuses);// Set web3, accounts, and contract to the state, and then proceed with an\n// example of interacting with the contract's methods.\n_this.setState({web3:web3,account:account[0],contract:instance,products:products,token:token,tokenName:tokenName,tokenSymbol:tokenSymbol,product:product,statuses:statuses,decimals:decimals,balance:balance});_context.next=45;break;case 41:_context.prev=41;_context.t0=_context[\"catch\"](0);// Catch any errors for any of the above operations.\nalert(\"Failed to load web3, accounts, or contract. Check console for details.\");console.error(_context.t0);case 45:case\"end\":return _context.stop();}}},_callee,null,[[0,41]]);}));_this.handleApprove=/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(price){var receipt;return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:_context2.next=2;return _this.state.token.methods.approve(_this.state.product,price).send({from:_this.state.account});case 2:receipt=_context2.sent;console.log(receipt);_this.setState({approved:true});case 5:case\"end\":return _context2.stop();}}},_callee2);}));return function(_x){return _ref2.apply(this,arguments);};}();_this.handleBuy=/*#__PURE__*/function(){var _ref3=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee3(id){return _regeneratorRuntime.wrap(function _callee3$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:_context3.next=2;return _this.state.contract.methods.buyProduct(id).send({from:_this.state.account});case 2:_context3.next=4;return _this.getProductStatuses();case 4:case\"end\":return _context3.stop();}}},_callee3);}));return function(_x2){return _ref3.apply(this,arguments);};}();_this.getProductStatuses=/*#__PURE__*/_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee4(){var statuses;return _regeneratorRuntime.wrap(function _callee4$(_context4){while(1){switch(_context4.prev=_context4.next){case 0:_context4.next=2;return _this.state.contract.methods.getProductStatuses().call();case 2:statuses=_context4.sent;_this.setState({statuses:statuses});case 4:case\"end\":return _context4.stop();}}},_callee4);}));return _this;}_createClass(Main,[{key:\"render\",value:function render(){var _this2=this;var content;if(!this.state.web3){return React.createElement(\"div\",null,\"Loading Web3, accounts, and contracts...\");}else if(this.state.products.length===0){content=React.createElement(\"h3\",{id:\"no-products\"},\"No products have been listed yet.\");}else{content=this.state.products.map(function(product,key){var status=_this2.state.statuses[key];return React.createElement(\"div\",{className:\"product\"},React.createElement(\"h2\",null,product.productName),React.createElement(\"p\",null,\"Price: \",product.productPrice/Math.pow(10,_this2.state.decimals),\" \",_this2.state.tokenSymbol),React.createElement(\"p\",null,\"Id: \",product.productId),React.createElement(\"p\",null,\"Seller: \",product.productSeller),React.createElement(\"p\",null,\"Status: \",status===1?\"Sold\":\"Unsold\"),status===0?!_this2.state.approved?React.createElement(\"button\",{onClick:function onClick(){return _this2.handleApprove(product.productPrice);}},\"Approve Contract\"):React.createElement(\"button\",{onClick:function onClick(){return _this2.handleBuy(product.productId);}},\"Buy\"):React.createElement(\"p\",null));});}return React.createElement(\"div\",{className:\"App\"},React.createElement(\"h1\",null,\"Product Marketplace\"),React.createElement(\"p\",null,\"Your \",this.state.tokenName,\" balance: \",this.state.balance/Math.pow(10,this.state.decimals)),React.createElement(\"div\",{id:\"products\"},content));}}]);return Main;}(Component);export default Main;","map":{"version":3,"sources":["/Users/israeladelaja/Desktop/Product DApp/client/src/Main.js"],"names":["React","Component","ProductBuyContract","TestToken","getWeb3","Main","state","products","web3","account","contract","token","tokenName","approved","product","statuses","decimals","balance","componentDidMount","window","ethereum","request","method","console","log","eth","net","getId","networkId","deployedNetworkProduct","networks","instance","Contract","abi","address","methods","call","tokenAddress","deployedNetworkToken","viewProducts","name","symbol","tokenSymbol","balanceOf","getProductStatuses","setState","alert","error","handleApprove","price","approve","send","from","receipt","handleBuy","id","buyProduct","content","length","map","key","status","productName","productPrice","productId","productSeller"],"mappings":"g6BAAA,MAAOA,CAAAA,KAAP,EAAgBC,SAAhB,KAAiC,OAAjC,CACA,MAAOC,CAAAA,kBAAP,KAA+B,6BAA/B,CACA,MAAOC,CAAAA,SAAP,KAAsB,4BAAtB,CACA,MAAOC,CAAAA,OAAP,KAAoB,WAApB,CAEA,MAAO,WAAP,C,GAGMC,CAAAA,I,uXAEJC,K,CAAQ,CAAEC,QAAQ,CAAE,IAAZ,CAAkBC,IAAI,CAAE,IAAxB,CAA8BC,OAAO,CAAE,IAAvC,CAA6CC,QAAQ,CAAE,IAAvD,CAA6DC,KAAK,CAAE,IAApE,CAA0EC,SAAS,CAAE,IAArF,CAA2FC,QAAQ,CAAE,KAArG,CAA4GC,OAAO,CAAE,IAArH,CAA2HC,QAAQ,CAAE,IAArI,CAA2IC,QAAQ,CAAE,IAArJ,CAA2JC,OAAO,CAAE,IAApK,C,OAERC,iB,sEAAoB,6UAGGd,CAAAA,OAAO,EAHV,QAGVI,IAHU,qCAMMW,CAAAA,MAAM,CAACC,QAAP,CAAgBC,OAAhB,CAAwB,CAAEC,MAAM,CAAE,cAAV,CAAxB,CANN,QAMVb,OANU,eAOhBc,OAAO,CAACC,GAAR,CAAYf,OAAO,CAAC,CAAD,CAAnB,EAEA;AATgB,uBAUQD,CAAAA,IAAI,CAACiB,GAAL,CAASC,GAAT,CAAaC,KAAb,EAVR,SAUVC,SAVU,eAWVC,sBAXU,CAWe3B,kBAAkB,CAAC4B,QAAnB,CAA4BF,SAA5B,CAXf,CAYVG,QAZU,CAYC,GAAIvB,CAAAA,IAAI,CAACiB,GAAL,CAASO,QAAb,CACf9B,kBAAkB,CAAC+B,GADJ,CAEfJ,sBAAsB,EAAIA,sBAAsB,CAACK,OAFlC,CAZD,wBAiBSH,CAAAA,QAAQ,CAACI,OAAT,CAAiBxB,KAAjB,GAAyByB,IAAzB,EAjBT,SAiBZC,YAjBY,eAmBVC,oBAnBU,CAmBanC,SAAS,CAAC2B,QAAV,CAAmBF,SAAnB,CAnBb,CAoBVjB,KApBU,CAoBF,GAAIH,CAAAA,IAAI,CAACiB,GAAL,CAASO,QAAb,CACZ7B,SAAS,CAAC8B,GADE,CAEZK,oBAAoB,EAAID,YAFZ,CApBE,CAyBZvB,OAzBY,CAyBFe,sBAAsB,CAACK,OAzBrB,wBA2BKH,CAAAA,QAAQ,CAACI,OAAT,CAAiBI,YAAjB,GAAgCH,IAAhC,EA3BL,SA2BZ7B,QA3BY,sCA6BMI,CAAAA,KAAK,CAACwB,OAAN,CAAcK,IAAd,GAAqBJ,IAArB,EA7BN,SA6BZxB,SA7BY,sCA+BQD,CAAAA,KAAK,CAACwB,OAAN,CAAcM,MAAd,GAAuBL,IAAvB,EA/BR,SA+BZM,WA/BY,sCAiCK/B,CAAAA,KAAK,CAACwB,OAAN,CAAcnB,QAAd,GAAyBoB,IAAzB,EAjCL,SAiCZpB,QAjCY,sCAmCIL,CAAAA,KAAK,CAACwB,OAAN,CAAcQ,SAAd,CAAwBlC,OAAO,CAAC,CAAD,CAA/B,EAAoC2B,IAApC,EAnCJ,SAmCZnB,OAnCY,sCAqCKc,CAAAA,QAAQ,CAACI,OAAT,CAAiBS,kBAAjB,GAAsCR,IAAtC,EArCL,SAqCZrB,QArCY,eAsChBQ,OAAO,CAACC,GAAR,CAAYT,QAAZ,EAEA;AACA;AACA,MAAK8B,QAAL,CAAc,CAAErC,IAAI,CAAJA,IAAF,CAAQC,OAAO,CAAEA,OAAO,CAAC,CAAD,CAAxB,CAA6BC,QAAQ,CAAEqB,QAAvC,CAAiDxB,QAAQ,CAARA,QAAjD,CAA2DI,KAAK,CAALA,KAA3D,CAAiEC,SAAS,CAATA,SAAjE,CAA4E8B,WAAW,CAAXA,WAA5E,CAAyF5B,OAAO,CAAPA,OAAzF,CAAkGC,QAAQ,CAARA,QAAlG,CAA4GC,QAAQ,CAARA,QAA5G,CAAsHC,OAAO,CAAPA,OAAtH,CAAd,EA1CgB,iFA6ChB;AACA6B,KAAK,0EAAL,CAGAvB,OAAO,CAACwB,KAAR,cAjDgB,qE,SAqDpBC,a,2FAAgB,kBAAOC,KAAP,yJACM,OAAK3C,KAAL,CAAWK,KAAX,CAAiBwB,OAAjB,CAAyBe,OAAzB,CAAiC,MAAK5C,KAAL,CAAWQ,OAA5C,CAAqDmC,KAArD,EAA4DE,IAA5D,CAAiE,CAACC,IAAI,CAAE,MAAK9C,KAAL,CAAWG,OAAlB,CAAjE,CADN,QACV4C,OADU,gBAEd9B,OAAO,CAACC,GAAR,CAAY6B,OAAZ,EACA,MAAKR,QAAL,CAAc,CAAChC,QAAQ,CAAE,IAAX,CAAd,EAHc,wD,sEAMhByC,S,2FAAY,kBAAOC,EAAP,6IACJ,OAAKjD,KAAL,CAAWI,QAAX,CAAoByB,OAApB,CAA4BqB,UAA5B,CAAuCD,EAAvC,EAA2CJ,IAA3C,CAAgD,CAACC,IAAI,CAAE,MAAK9C,KAAL,CAAWG,OAAlB,CAAhD,CADI,+BAEJ,OAAKmC,kBAAL,EAFI,yD,uEAKZA,kB,sEAAqB,4KACE,OAAKtC,KAAL,CAAWI,QAAX,CAAoByB,OAApB,CAA4BS,kBAA5B,GAAiDR,IAAjD,EADF,QACfrB,QADe,gBAEnB,MAAK8B,QAAL,CAAc,CAAC9B,QAAQ,CAARA,QAAD,CAAd,EAFmB,wD,yEAKZ,iBACP,GAAI0C,CAAAA,OAAJ,CACA,GAAI,CAAC,KAAKnD,KAAL,CAAWE,IAAhB,CAAsB,CACpB,MAAO,2EAAP,CACD,CAFD,IAEO,IAAI,KAAKF,KAAL,CAAWC,QAAX,CAAoBmD,MAApB,GAA+B,CAAnC,CAAsC,CAC3CD,OAAO,CAAG,0BAAI,EAAE,CAAC,aAAP,sCAAV,CACD,CAFM,IAEA,CACLA,OAAO,CAAG,KAAKnD,KAAL,CAAWC,QAAX,CAAoBoD,GAApB,CAAwB,SAAC7C,OAAD,CAAU8C,GAAV,CAAkB,CAClD,GAAIC,CAAAA,MAAM,CAAG,MAAI,CAACvD,KAAL,CAAWS,QAAX,CAAoB6C,GAApB,CAAb,CACA,MACE,4BAAK,SAAS,CAAC,SAAf,EACE,8BAAK9C,OAAO,CAACgD,WAAb,CADF,CAEE,uCAAWhD,OAAO,CAACiD,YAAR,UAAqB,EAArB,CAAyB,MAAI,CAACzD,KAAL,CAAWU,QAApC,CAAX,KAA0D,MAAI,CAACV,KAAL,CAAWoC,WAArE,CAFF,CAGE,oCAAQ5B,OAAO,CAACkD,SAAhB,CAHF,CAIE,wCAAYlD,OAAO,CAACmD,aAApB,CAJF,CAKE,wCAAYJ,MAAM,GAAK,CAAX,CAAe,MAAf,CAAwB,QAApC,CALF,CAMGA,MAAM,GAAK,CAAX,CAAe,CAAC,MAAI,CAACvD,KAAL,CAAWO,QAAZ,CAAuB,8BAAQ,OAAO,CAAE,yBAAM,CAAA,MAAI,CAACmC,aAAL,CAAmBlC,OAAO,CAACiD,YAA3B,CAAN,EAAjB,qBAAvB,CAAoH,8BAAQ,OAAO,CAAE,yBAAM,CAAA,MAAI,CAACT,SAAL,CAAexC,OAAO,CAACkD,SAAvB,CAAN,EAAjB,QAAnI,CAA4M,6BAN/M,CADF,CAUD,CAZS,CAAV,CAaD,CACD,MACE,4BAAK,SAAS,CAAC,KAAf,EACE,oDADF,CAEE,qCAAS,KAAK1D,KAAL,CAAWM,SAApB,cAAyC,KAAKN,KAAL,CAAWW,OAAX,UAAmB,EAAnB,CAAuB,KAAKX,KAAL,CAAWU,QAAlC,CAAzC,CAFF,CAGE,2BAAK,EAAE,CAAC,UAAR,EACGyC,OADH,CAHF,CADF,CASD,C,kBAvGgBxD,S,EA0GnB,cAAeI,CAAAA,IAAf","sourcesContent":["import React, { Component } from \"react\";\nimport ProductBuyContract from \"./contracts/ProductBuy.json\";\nimport TestToken from \"./contracts/TestToken.json\";\nimport getWeb3 from \"./getWeb3\";\n\nimport \"./App.css\";\n\n\nclass Main extends Component {\n\n  state = { products: null, web3: null, account: null, contract: null, token: null, tokenName: null, approved: false, product: null, statuses: null, decimals: null, balance: null };\n\n  componentDidMount = async () => {\n    try {\n      // Get network provider and web3 instance.\n      const web3 = await getWeb3();\n\n      // Use web3 to get the user's accounts.\n      const account = await window.ethereum.request({ method: 'eth_accounts' });\n      console.log(account[0])\n\n      // Get the contract instance.\n      const networkId = await web3.eth.net.getId();\n      const deployedNetworkProduct = ProductBuyContract.networks[networkId];\n      const instance = new web3.eth.Contract(\n        ProductBuyContract.abi,\n        deployedNetworkProduct && deployedNetworkProduct.address,\n      );\n\n      let tokenAddress = await instance.methods.token().call();\n\n      const deployedNetworkToken = TestToken.networks[networkId];\n      const token = new web3.eth.Contract(\n        TestToken.abi,\n        deployedNetworkToken && tokenAddress,\n      );\n\n      let product = deployedNetworkProduct.address;\n\n      let products = await instance.methods.viewProducts().call();\n\n      let tokenName = await token.methods.name().call();\n\n      let tokenSymbol = await token.methods.symbol().call();\n\n      let decimals = await token.methods.decimals().call();\n\n      let balance = await token.methods.balanceOf(account[0]).call();\n\n      let statuses = await instance.methods.getProductStatuses().call();\n      console.log(statuses)\n\n      // Set web3, accounts, and contract to the state, and then proceed with an\n      // example of interacting with the contract's methods.\n      this.setState({ web3, account: account[0], contract: instance, products, token,tokenName, tokenSymbol, product, statuses, decimals, balance });\n\n    } catch (error) {\n      // Catch any errors for any of the above operations.\n      alert(\n        `Failed to load web3, accounts, or contract. Check console for details.`,\n      );\n      console.error(error);\n    }\n  };\n\n  handleApprove = async (price) => {\n    let receipt = await this.state.token.methods.approve(this.state.product, price).send({from: this.state.account});\n    console.log(receipt)\n    this.setState({approved: true})\n  }\n\n  handleBuy = async (id) => {\n    await this.state.contract.methods.buyProduct(id).send({from: this.state.account});\n    await this.getProductStatuses();\n  }\n\n  getProductStatuses = async () => {\n    let statuses = await this.state.contract.methods.getProductStatuses().call();\n    this.setState({statuses});\n  }\n  \n  render() {\n    let content;\n    if (!this.state.web3) {\n      return <div>Loading Web3, accounts, and contracts...</div>;\n    } else if (this.state.products.length === 0) {\n      content = <h3 id=\"no-products\">No products have been listed yet.</h3>\n    } else {\n      content = this.state.products.map((product, key) => {\n        let status = this.state.statuses[key]\n        return ( \n          <div className=\"product\">\n            <h2>{product.productName}</h2>\n            <p>Price: {product.productPrice/10**this.state.decimals} {this.state.tokenSymbol}</p>\n            <p>Id: {product.productId}</p>\n            <p>Seller: {product.productSeller}</p>\n            <p>Status: {status === 1 ? \"Sold\" : \"Unsold\"}</p>\n            {status === 0 ? !this.state.approved ? <button onClick={() => this.handleApprove(product.productPrice)}>Approve Contract</button> : <button onClick={() => this.handleBuy(product.productId)}>Buy</button> : <p></p>}\n          </div>\n        )    \n      })\n    }\n    return (\n      <div className=\"App\">\n        <h1>Product Marketplace</h1>\n        <p>Your {this.state.tokenName} balance: {this.state.balance/10**this.state.decimals}</p>\n        <div id=\"products\">\n          {content}\n        </div>\n      </div>\n    );\n  }\n}\n\nexport default Main;\n"]},"metadata":{},"sourceType":"module"}