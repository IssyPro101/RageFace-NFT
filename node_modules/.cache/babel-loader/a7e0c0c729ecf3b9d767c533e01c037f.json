{"ast":null,"code":"import _regeneratorRuntime from\"/Users/israeladelaja/Desktop/Product DApp/client/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"/Users/israeladelaja/Desktop/Product DApp/client/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _classCallCheck from\"/Users/israeladelaja/Desktop/Product DApp/client/node_modules/@babel/runtime/helpers/esm/classCallCheck\";import _createClass from\"/Users/israeladelaja/Desktop/Product DApp/client/node_modules/@babel/runtime/helpers/esm/createClass\";import _possibleConstructorReturn from\"/Users/israeladelaja/Desktop/Product DApp/client/node_modules/@babel/runtime/helpers/esm/possibleConstructorReturn\";import _getPrototypeOf from\"/Users/israeladelaja/Desktop/Product DApp/client/node_modules/@babel/runtime/helpers/esm/getPrototypeOf\";import _inherits from\"/Users/israeladelaja/Desktop/Product DApp/client/node_modules/@babel/runtime/helpers/esm/inherits\";import React,{Component}from'react';import ProductBuyContract from\"./contracts/ProductBuy.json\";import TestToken from\"./contracts/TestToken.json\";import getWeb3 from\"./getWeb3\";import\"./App.css\";var ipfsClient=require('ipfs-http-client');var ipfs=ipfsClient({host:'ipfs.infura.io',port:5001,protocol:'https'});// leaving out the arguments will default to these values\nvar ListProducts=/*#__PURE__*/function(_Component){_inherits(ListProducts,_Component);function ListProducts(){var _getPrototypeOf2;var _this;_classCallCheck(this,ListProducts);for(var _len=arguments.length,args=new Array(_len),_key=0;_key<_len;_key++){args[_key]=arguments[_key];}_this=_possibleConstructorReturn(this,(_getPrototypeOf2=_getPrototypeOf(ListProducts)).call.apply(_getPrototypeOf2,[this].concat(args)));_this.state={loading:false,products:[],web3:null,account:\"\",contract:null,token:null,tokenName:null,approved:false,product:null,statuses:null,taxTolerance:null,priceWithTax:\"0\",decimals:null};_this.componentDidMount=/*#__PURE__*/_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){var web3,account,networkId,deployedNetworkProduct,instance,tokenAddress,deployedNetworkToken,token,product,products,tokenName,tokenSymbol,taxTolerance,decimals;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.prev=0;_context.next=3;return getWeb3();case 3:web3=_context.sent;_context.next=6;return window.ethereum.request({method:'eth_accounts'});case 6:account=_context.sent;console.log(account[0]);// Get the contract instance.\n_context.next=10;return web3.eth.net.getId();case 10:networkId=_context.sent;deployedNetworkProduct=ProductBuyContract.networks[networkId];instance=new web3.eth.Contract(ProductBuyContract.abi,deployedNetworkProduct&&deployedNetworkProduct.address);_context.next=15;return instance.methods.token().call();case 15:tokenAddress=_context.sent;deployedNetworkToken=TestToken.networks[networkId];token=new web3.eth.Contract(TestToken.abi,deployedNetworkToken&&tokenAddress);product=deployedNetworkProduct.address;_context.next=21;return instance.methods.viewProducts().call();case 21:products=_context.sent;_context.next=24;return token.methods.name().call();case 24:tokenName=_context.sent;_context.next=27;return token.methods.symbol().call();case 27:tokenSymbol=_context.sent;_context.next=30;return instance.methods.taxTolerance().call();case 30:taxTolerance=_context.sent;_context.next=33;return token.methods.decimals().call();case 33:decimals=_context.sent;// Set web3, accounts, and contract to the state, and then proceed with an\n// example of interacting with the contract's methods.\n_this.setState({web3:web3,account:account[0],contract:instance,products:products,token:token,tokenName:tokenName,tokenSymbol:tokenSymbol,product:product,taxTolerance:taxTolerance,decimals:decimals});_context.next=41;break;case 37:_context.prev=37;_context.t0=_context[\"catch\"](0);// Catch any errors for any of the above operations.\nalert(\"Failed to load web3, accounts, or contract. Check console for details.\");console.error(_context.t0);case 41:case\"end\":return _context.stop();}}},_callee,null,[[0,37]]);}));_this.captureFile=function(event){event.preventDefault();var file=event.target.files[0];var image=document.getElementById('output');image.src=URL.createObjectURL(file);var fileName=file.name;var fileExtension=file.type;_this.setState({fileName:fileName});_this.setState({fileExtension:fileExtension});var reader=new window.FileReader();reader.readAsArrayBuffer(file);reader.onloadend=function(){_this.setState({buffer:Buffer(reader.result)});console.log('buffer',_this.state.buffer);};};_this.handleSubmit=/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee3(event){var name,link,price,description,decimals,tokenAmount,tokenAmountHex;return _regeneratorRuntime.wrap(function _callee3$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:event.preventDefault();name=document.getElementsByName(\"field1\")[0].value;link=document.getElementsByName(\"field2\")[0].value;price=document.getElementsByName(\"field3\")[0].value;description=document.getElementsByName(\"field4\")[0].value;// Decimal\ndecimals=_this.state.web3.utils.toBN(_this.state.decimals);// Amount of token\ntokenAmount=_this.state.web3.utils.toBN(price);// Amount as Hex - contract.methods.transfer(toAddress, tokenAmountHex).encodeABI();\ntokenAmountHex='0x'+tokenAmount.mul(_this.state.web3.utils.toBN(10).pow(decimals)).toString('hex');_context3.next=10;return ipfs.add(_this.state.buffer,/*#__PURE__*/function(){var _ref3=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(error,result){return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:_this.setState({loading:true});if(!error){_context2.next=4;break;}console.error(error);return _context2.abrupt(\"return\");case 4:_context2.next=6;return _this.state.contract.methods.listProduct(name,link,tokenAmountHex,result[0].hash,description).send({from:_this.state.account});case 6:_this.setState({loading:false});window.location.reload();case 8:case\"end\":return _context2.stop();}}},_callee2);}));return function(_x2,_x3){return _ref3.apply(this,arguments);};}());case 10:case\"end\":return _context3.stop();}}},_callee3);}));return function(_x){return _ref2.apply(this,arguments);};}();_this.handlePrice=/*#__PURE__*/function(){var _ref4=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee4(event){var priceWithTax;return _regeneratorRuntime.wrap(function _callee4$(_context4){while(1){switch(_context4.prev=_context4.next){case 0:if(_this.state.taxTolerance!==\"0\"){priceWithTax=document.getElementsByName(\"field3\")[0].value*(100-_this.state.taxTolerance)/100;_this.setState({priceWithTax:priceWithTax});}else{_this.setState({priceWithTax:document.getElementsByName(\"field3\")[0].value});}case 1:case\"end\":return _context4.stop();}}},_callee4);}));return function(_x4){return _ref4.apply(this,arguments);};}();return _this;}_createClass(ListProducts,[{key:\"render\",value:function render(){var _this2=this;var content;var status;if(!this.state.web3){return React.createElement(\"div\",null,\"Loading Web3, accounts, and contracts...\");}else if(this.state.loading){status=React.createElement(\"h1\",null,\"Uploading Product...\");content=this.state.products.map(function(product,key){return React.createElement(\"div\",{className:\"product\"},React.createElement(\"h2\",null,product.productName),React.createElement(\"img\",{class:\"productImage\",src:\"https://ipfs.infura.io/ipfs/\".concat(product.productImage),alt:\"Product\"}),React.createElement(\"p\",null,product.productDescription),React.createElement(\"p\",null,\"Price: \",product.productPrice/Math.pow(10,_this2.state.decimals),\" \",_this2.state.tokenSymbol),React.createElement(\"p\",null,\"Id: \",product.productId),React.createElement(\"p\",null,\"Seller: You\"),React.createElement(\"p\",null,\"Status: \",status===\"1\"?\"Sold\":\"Unsold\"));});}else if(!this.state.loading){status=React.createElement(\"h1\",null,\"Product Details\");content=this.state.products.map(function(product,key){return React.createElement(\"div\",{className:\"product\"},React.createElement(\"h2\",null,product.productName),React.createElement(\"img\",{class:\"productImage\",src:\"https://ipfs.infura.io/ipfs/\".concat(product.productImage),alt:\"Product\"}),React.createElement(\"p\",null,product.productDescription),React.createElement(\"p\",null,\"Price: \",product.productPrice/Math.pow(10,_this2.state.decimals),\" \",_this2.state.tokenSymbol),React.createElement(\"p\",null,\"Id: \",product.productId),React.createElement(\"p\",null,\"Seller: You\"),React.createElement(\"p\",null,\"Status: \",status===\"1\"?\"Sold\":\"Unsold\"));});}else if(this.state.products.length===\"0\"){content=React.createElement(\"h3\",{id:\"no-products\"},\"You haven't listed any products.\");}else{content=this.state.products.map(function(product,key){return React.createElement(\"div\",{className:\"product\"},React.createElement(\"h2\",null,product.productName),React.createElement(\"img\",{class:\"productImage\",src:\"https://ipfs.infura.io/ipfs/\".concat(product.productImage),alt:\"Product\"}),React.createElement(\"p\",null,product.productDescription),React.createElement(\"p\",null,\"Price: \",product.productPrice/Math.pow(10,_this2.state.decimals),\" \",_this2.state.tokenSymbol),React.createElement(\"p\",null,\"Id: \",product.productId),React.createElement(\"p\",null,\"Seller: You\"),React.createElement(\"p\",null,\"Status: \",status===\"1\"?\"Sold\":\"Unsold\"));});}return React.createElement(\"div\",{className:\"App\"},React.createElement(\"h1\",null,\"List a Product\"),React.createElement(\"div\",{class:\"form-style-6\"},status,React.createElement(\"form\",null,React.createElement(\"input\",{type:\"text\",name:\"field1\",placeholder:\"Product Name\"}),React.createElement(\"input\",{type:\"text\",name:\"field2\",placeholder:\"Product Link (make sure link is http or https)\"}),React.createElement(\"input\",{onChange:this.handlePrice,type:\"text\",name:\"field3\",placeholder:\"Product Price in \"+this.state.tokenName}),React.createElement(\"textarea\",{name:\"field4\",placeholder:\"Product Description\"}),React.createElement(\"p\",null,\"Upload a picture:\"),React.createElement(\"p\",null,React.createElement(\"img\",{id:\"output\",width:\"200\",alt:\"Upload\"})),React.createElement(\"input\",{type:\"file\",accept:\"image/*\",name:\"image\",id:\"file\",onChange:this.captureFile}),React.createElement(\"p\",{id:\"receive\"},\"You will receive \",this.state.priceWithTax,\" \",this.state.tokenSymbol,\" (\",this.state.taxTolerance+\"% tax on \"+this.state.tokenName+\" transfer\",\")\"),React.createElement(\"input\",{id:\"submit\",type:\"submit\",value:\"List\",onClick:this.handleSubmit}))),React.createElement(\"h1\",null,\"My Listed Products\"),React.createElement(\"div\",{id:\"products\"},content));}}]);return ListProducts;}(Component);export default ListProducts;","map":{"version":3,"sources":["/Users/israeladelaja/Desktop/Product DApp/client/src/ListProducts.js"],"names":["React","Component","ProductBuyContract","TestToken","getWeb3","ipfsClient","require","ipfs","host","port","protocol","ListProducts","state","loading","products","web3","account","contract","token","tokenName","approved","product","statuses","taxTolerance","priceWithTax","decimals","componentDidMount","window","ethereum","request","method","console","log","eth","net","getId","networkId","deployedNetworkProduct","networks","instance","Contract","abi","address","methods","call","tokenAddress","deployedNetworkToken","viewProducts","name","symbol","tokenSymbol","setState","alert","error","captureFile","event","preventDefault","file","target","files","image","document","getElementById","src","URL","createObjectURL","fileName","fileExtension","type","reader","FileReader","readAsArrayBuffer","onloadend","buffer","Buffer","result","handleSubmit","getElementsByName","value","link","price","description","utils","toBN","tokenAmount","tokenAmountHex","mul","pow","toString","add","listProduct","hash","send","from","location","reload","handlePrice","content","status","map","key","productName","productImage","productDescription","productPrice","productId","length"],"mappings":"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","sourcesContent":["import React, { Component } from 'react'\nimport ProductBuyContract from \"./contracts/ProductBuy.json\";\nimport TestToken from \"./contracts/TestToken.json\";\nimport getWeb3 from \"./getWeb3\";\nimport \"./App.css\";\n\nconst ipfsClient = require('ipfs-http-client')\nconst ipfs = ipfsClient({ host: 'ipfs.infura.io', port: 5001, protocol: 'https' }) // leaving out the arguments will default to these values\n\nclass ListProducts extends Component {\n\n    state = { loading: false, products: [], web3: null, account: \"\", contract: null, token: null, tokenName: null, approved: false, product: null, statuses: null, taxTolerance: null, priceWithTax: \"0\", decimals: null }\n\n    componentDidMount = async () => {\n        try {\n          // Get network provider and web3 instance.\n            const web3 = await getWeb3();\n\n            const account = await window.ethereum.request({ method: 'eth_accounts' });\n            console.log(account[0])\n\n            // Get the contract instance.\n            const networkId = await web3.eth.net.getId();\n            const deployedNetworkProduct = ProductBuyContract.networks[networkId];\n            const instance = new web3.eth.Contract(\n                ProductBuyContract.abi,\n                deployedNetworkProduct && deployedNetworkProduct.address,\n            );\n\n            let tokenAddress = await instance.methods.token().call();\n\n            const deployedNetworkToken = TestToken.networks[networkId];\n            const token = new web3.eth.Contract(\n                TestToken.abi,\n                deployedNetworkToken && tokenAddress,\n            );\n\n            let product = deployedNetworkProduct.address;\n\n            let products = await instance.methods.viewProducts().call();\n\n            let tokenName = await token.methods.name().call();\n\n            let tokenSymbol = await token.methods.symbol().call();\n\n            let taxTolerance = await instance.methods.taxTolerance().call();\n\n            let decimals = await token.methods.decimals().call();\n\n\n          // Set web3, accounts, and contract to the state, and then proceed with an\n          // example of interacting with the contract's methods.\n          this.setState({web3, account: account[0], contract: instance, products, token, tokenName, tokenSymbol, product, taxTolerance, decimals});\n    \n        } catch (error) {\n          // Catch any errors for any of the above operations.\n          alert(\n            `Failed to load web3, accounts, or contract. Check console for details.`,\n          );\n          console.error(error);\n        }\n    };\n\n    captureFile = (event) => {\n      event.preventDefault()\n  \n      const file = event.target.files[0]\n      var image = document.getElementById('output');\n      image.src = URL.createObjectURL(file);\n      const fileName = file.name\n      const fileExtension = file.type\n      this.setState({fileName})\n      this.setState({fileExtension})\n      const reader = new window.FileReader()\n      reader.readAsArrayBuffer(file)\n      reader.onloadend = () => {\n        this.setState({ buffer: Buffer(reader.result) })\n        console.log('buffer', this.state.buffer)\n      }\n    }\n  \n\n    handleSubmit = async (event) => {\n        event.preventDefault();\n\n        let name = document.getElementsByName(\"field1\")[0].value;\n        let link = document.getElementsByName(\"field2\")[0].value;\n        let price = document.getElementsByName(\"field3\")[0].value;\n        let description = document.getElementsByName(\"field4\")[0].value;\n\n        // Decimal\n        const decimals = this.state.web3.utils.toBN(this.state.decimals);\n\n        // Amount of token\n        const tokenAmount = this.state.web3.utils.toBN(price);\n\n        // Amount as Hex - contract.methods.transfer(toAddress, tokenAmountHex).encodeABI();\n        const tokenAmountHex = '0x' + tokenAmount.mul(this.state.web3.utils.toBN(10).pow(decimals)).toString('hex');\n\n        await ipfs.add(this.state.buffer, async (error, result) => {\n          this.setState({loading: true})\n          if(error) {\n            console.error(error)\n            return\n          }\n          await this.state.contract.methods.listProduct(name, link, tokenAmountHex, result[0].hash, description).send({from: this.state.account})\n\n          this.setState({loading: false})\n          window.location.reload();\n        })\n\n    }\n\n    handlePrice = async (event) => {\n        if (this.state.taxTolerance !== \"0\") {\n            let priceWithTax = document.getElementsByName(\"field3\")[0].value * (100 - this.state.taxTolerance) / 100;\n            this.setState({priceWithTax})\n        } else {\n            this.setState({priceWithTax: document.getElementsByName(\"field3\")[0].value})\n        }\n\n    }\n\n\n  render() {\n    let content;\n    let status;\n    if (!this.state.web3) {\n      return <div>Loading Web3, accounts, and contracts...</div>;\n    } else if (this.state.loading) {\n      status = <h1>Uploading Product...</h1>\n      content = this.state.products.map((product, key) => {\n        return ( \n            <div className=\"product\">\n              <h2>{product.productName}</h2>\n              <img class=\"productImage\" src={`https://ipfs.infura.io/ipfs/${product.productImage}`} alt=\"Product\"/>\n              <p>{product.productDescription}</p>\n              <p>Price: {product.productPrice/10**this.state.decimals} {this.state.tokenSymbol}</p>\n              <p>Id: {product.productId}</p>\n              <p>Seller: You</p>\n              <p>Status: {status === \"1\" ? \"Sold\" : \"Unsold\"}</p>\n            </div>\n        )    \n\n      })\n    } else if (!this.state.loading) {\n      status = <h1>Product Details</h1>\n      content = this.state.products.map((product, key) => {\n        return ( \n            <div className=\"product\">\n              <h2>{product.productName}</h2>\n              <img class=\"productImage\" src={`https://ipfs.infura.io/ipfs/${product.productImage}`} alt=\"Product\"/>\n              <p>{product.productDescription}</p>\n              <p>Price: {product.productPrice/10**this.state.decimals} {this.state.tokenSymbol}</p>\n              <p>Id: {product.productId}</p>\n              <p>Seller: You</p>\n              <p>Status: {status === \"1\" ? \"Sold\" : \"Unsold\"}</p>\n            </div>\n        )    \n\n      })\n    } else if (this.state.products.length === \"0\") {\n      content = <h3 id=\"no-products\">You haven't listed any products.</h3>\n    } else {\n      content = this.state.products.map((product, key) => {\n        return ( \n            <div className=\"product\">\n              <h2>{product.productName}</h2>\n              <img class=\"productImage\" src={`https://ipfs.infura.io/ipfs/${product.productImage}`} alt=\"Product\"/>\n              <p>{product.productDescription}</p>\n              <p>Price: {product.productPrice/10**this.state.decimals} {this.state.tokenSymbol}</p>\n              <p>Id: {product.productId}</p>\n              <p>Seller: You</p>\n              <p>Status: {status === \"1\" ? \"Sold\" : \"Unsold\"}</p>\n            </div>\n        )    \n\n      })\n    }\n    return (\n        <div className=\"App\">\n            <h1>List a Product</h1>\n            <div class=\"form-style-6\">\n              {status}\n                <form>\n                    <input type=\"text\" name=\"field1\" placeholder=\"Product Name\" />\n                    <input type=\"text\" name=\"field2\" placeholder=\"Product Link (make sure link is http or https)\" />\n                    <input onChange={this.handlePrice} type=\"text\" name=\"field3\" placeholder={\"Product Price in \" + this.state.tokenName}></input>\n                    <textarea  name=\"field4\" placeholder=\"Product Description\"></textarea>\n                    <p>Upload a picture:</p>\n                    <p><img id=\"output\" width=\"200\" alt=\"Upload\"/></p>\n                    <input type='file' accept=\"image/*\" name=\"image\" id=\"file\" onChange={this.captureFile}/>\n                    <p id=\"receive\">You will receive {this.state.priceWithTax} {this.state.tokenSymbol} ({this.state.taxTolerance + \"% tax on \" + this.state.tokenName + \" transfer\"})</p>\n                    <input id=\"submit\" type=\"submit\" value=\"List\" onClick={this.handleSubmit} />\n                </form>\n            </div>\n            <h1>My Listed Products</h1>\n            <div id=\"products\">\n              {content}\n            </div>\n        </div>\n    );\n  }\n}\n\nexport default ListProducts;\n"]},"metadata":{},"sourceType":"module"}